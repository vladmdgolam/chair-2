var tcart_newDelivery={deliveryState:{currentRequest:null,projectId:null,city:{},services:{},searchboxes:{},focusoutTimers:{},cityCoordinates:null,ymapApiKey:null,cityGuid:null,streetGuid:null,currencyCode:null,pickupList:null,postalCode:null,staticCities:null,geoData:null,autocompleteData:{cities:null},badResponseCounters:{services:0},activeServiceUid:null,freeDeliveryThreshold:null,fullNames:{city:"",street:"",house:"",pickup:""}},init:function(e){console.log("NEW DELIVERY INIT"),window.tcart_newDeliveryActive=!0,this.deliveryState.projectId=parseInt($("#allrecords").attr("data-tilda-project-id"),10),this.deliveryState.currencyCode=$(".t706").attr("data-project-currency-code"),this.deliveryState.ymapApiKey=e,this.deliveryState.ymapApiKey&&this.mapAppendScript("",e);var r=this,t=$(".t-radio__wrapper-delivery").first();0<$(".t-radio__wrapper-delivery").length&&$(".t-radio__wrapper-delivery").html(""),t.attr("id","customdelivery");var a=tcart_newDelivery.createTitle(tcart__dict(30,"Delivery"));t.append(a),this.appendStyleFromSettings();var i=tcart_newDelivery.createInput("",tcart__dict(23,"City"),null,null,null,null,"searchbox-input load js-tilda-rule","tildadelivery-city",null,null,!0,null,"chosevalue"),s=this.createSearchbox(i,"city-searchbox"),d=tcart_newDelivery.createInput("","",null,null,null,null,"","tildadelivery-postalcode",!0),o=tcart_newDelivery.createInput("","hash",null,null,null,null,"","tildadelivery-hash",!0),n=tcart_newDelivery.createInput("","country",null,null,null,null,"","tildadelivery-country",!0);t.append(d),t.append(o),t.append(n),t.append(s.outerHTML),this.searchboxInit("city-searchbox","city");var c=document.createElement("div");c.id="delivery-services-wrapper",t.append(c),$.when(this.getCityFromGeo(this.deliveryState.projectId)).then(function(e){var t;e&&((r.deliveryState.geoData=e).cities?(t=e.cities[0],r.deliveryState.staticCities=e.cities):t=e,t&&(r.deliveryState.city=t,r.deliveryState.cityGuid=t.guid,r.deliveryState.countryIso=t.countryIso,r.deliveryState.postalCode=t.postalCode,r.deliveryState.cityPostalCode=t.postalCode),""!==t.name?($("#city-searchbox").find(".t-input-description").html(t.fullName),$('[name="tildadelivery-country"]').val(t.countryIso),r.deliveryState.ymapApiKey&&$.when(r.getCityCoordinates("yandex",t.name)).done(function(e){var t;try{(t=e.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(t=[t[1],t[0]],r.deliveryState.cityCoordinates=t)}catch(e){console.error(e)}}),r.deliveryState.searchboxes["city-searchbox"]||(r.deliveryState.searchboxes["city-searchbox"]={}),r.deliveryState.searchboxes["city-searchbox"].address=t,r.deliveryState.fullNames.city=t.fullName,$('input[name="tildadelivery-city"]').val(t.name),$('input[name="tildadelivery-city"]').attr("data-option-selected",!0),r.setPostalCodeInput(t.postalCode),r.renderServices(t.postalCode)):$(".t706 #city-searchbox input").removeClass("load"))},function(){}),$(document).keydown(function(e){77==e.keyCode&&console.log(r.deliveryState)}),$(document).on("click",".t-input-clear",function(){var e=$(this).closest(".searchbox-wrapper").attr("id");$("#"+e).find(".searchbox-list").html("");var t=r.deliveryState.focusoutTimers[e];clearTimeout(t),$(this).siblings(".searchbox-input").val(""),$(this).closest(".t-input-block").removeClass("active"),$(this).siblings(".searchbox-input").focus(),r.deliveryState.searchboxes[e]&&r.deliveryState.searchboxes[e].address&&(r.deliveryState.searchboxes[e].address=null)}),$(document).on("click",".searchbox-change-pickup",function(){$(this).closest(".searchbox-wrapper").removeClass("show-info")}),this.renderFullAddressNode()},appendStyleFromSettings:function(){var e,t=document.querySelector("script"),r=$(".t706 .t-form__inputsbox .t-input-group").find('input[type="text"]').first(),a="";r.length?(e=r[0],r.hasClass("t-input_bbonly")&&(a+="outline: none; padding-left: 0!important; padding-right: 0!important; border-top: 0!important; border-right: 0!important; border-left: 0!important; background-color: transparent!important; border-radius: 0!important;"),a+=e.style.cssText):a+="color: #000000; border: 1px solid #000000;";var i=document.createElement("style");i.innerHTML=".t706 .t-form__inputsbox #customdelivery .t-input {"+a+"}",t.parentNode.insertBefore(i,t);var s,d,o=$(".t706 .t-form__inputsbox .t-input-group").find(".t-input-title").first();o.length&&(s="",s+=o[0].style.cssText,(d=document.createElement("style")).innerHTML=".t706 .t-form__inputsbox #customdelivery .t-input-title {"+s+"}",t.parentNode.insertBefore(d,t))},disableChoseServiceControls:function(){$('.t706 input[name="tildadelivery-type"]').attr("disabled","disabled")},enableChoseServiceControls:function(){$('.t706 input[name="tildadelivery-type"]').attr("disabled",!1)},getFullAddress:function(){var e=this.deliveryState.fullNames,t="";return e.pickup?t+=e.city+", "+e.pickup:e.street&&(t+=e.city+", "+e.street),e.house&&(t+=" "+e.house),t},renderFullAddressNode:function(){var e=document.createElement("div");e.classList.add("delivery-full-address"),e.classList.add("t-descr");var t=document.querySelector(".t706__cartwin-totalamount-info");$(t).after(e)},setFullAddress:function(e){document.querySelector(".delivery-full-address").innerHTML=e},changeCartInputsHandler:function(){var e=$(".t706"),t=this;e.find("input").on("change",function(){t.fillTcartDelivery()})},fillTcartDelivery:function(){var a=$(".t706");["city","street","pickup-name","pickup-address","pickup-id","house","entrance","floor","aptoffice","phone","entrancecode","comment","service-id","hash","postalcode","country","userinitials","onelineaddress"].forEach(function(e){var t="",r="tildadelivery-"+e;switch(e){case"service-id":t=a.find('[name="tildadelivery-type"]:checked').attr("data-service-id");break;case"pickup-id":t=a.find("[data-pickup-id]").attr("data-pickup-id");break;case"pickup-address":t=a.find("[data-pickup-address]").attr("data-pickup-address");break;default:t=a.find("[name="+r+"]").val()}t&&window.tcart.delivery&&(window.tcart.delivery[e]=t)})},mapAppendScript:function(e,t){var r=document.createElement("script");r.src="https://api-maps.yandex.ru/2.1/?apikey="+t+"&lang=ru_RU",$("head").append(r)},mapInit:function(e){switch(e){case"yandex":var t=document.createElement("div");t.id="delivery-yandex-map",$("#pickup-searchbox .searchbox-inner-wrapper").append(t);var r=this;window.ymaps.ready(function(){window.deliveryMap=new ymaps.Map("delivery-yandex-map",{center:r.deliveryState.cityCoordinates||[55.76,37.64],zoom:8,controls:["zoomControl"]},{yandexMapDisablePoiInteractivity:!0})})}},mapAddPoints:function(e,u,p){var v=this;window.ymaps.ready(function(){window.deliveryMap.geoObjects&&window.deliveryMap.geoObjects.removeAll();var t=[];u.forEach(function(e){0===e.coordinates[0]&&0===e.coordinates[1]||t.push(e.coordinates)});for(var e=new ymaps.Clusterer({preset:"islands#circleIcon",groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1}),r=[],l=0,a=t.length;l<a;l++)r[l]=new ymaps.Placemark(t[l],function(e){var t=u[e],r=t.name,a=t.address||"",i=t.workTime||"",s=t.phones||"",d=t.addressComment||"",o="";o+="<b>"+r+"</b>";var n="";n+="<b>"+tcart__dict(31,"Address")+": </b>"+a+"</br>";var c="";return t.cash&&"n"===t.cash&&(c+="cash"),n+='<div style="margin: 10px 0;" class="delivery-map-point-select" '+(c?'data-restrictions="'+c+'"':"")+" data-point-index="+e+' onclick="window.tcart__chosePointOnMap(this); return false;">'+tcart__dict(37,"Select")+"</div>",n+=d?d+"</br>":"",n+=i?"<b>"+tcart__dict(40,"Working hours")+": </b>"+i+"</br>":"",s.length&&(n+=(1<s.length?"<b>"+tcart__dict(38,"Phones")+": </b>":"<b>"+tcart__dict(39,"Phone")+": </b>")+s.join(", ")+"</br>"),window.tcart__chosePointOnMap=function(e){l=e.dataset.pointIndex;var t=u[l],r=p.find(".searchbox-input"),a=p.attr("id");tcart__inputErrorHandler.hide(r),v.deliveryState.searchboxes[a]||(v.deliveryState.searchboxes[a]={}),r.attr("data-option-selected",!0),v.deliveryState.fullNames.pickup=t.address,v.deliveryState.postalCode=t.postalCode,v.setPostalCodeInput(t.postalCode),v.changePickupHandler(t.id,t.name,t.postalCode,p,t.address),$('.706 [name="tildadelivery-pickup-name"]').val(t.name),v.fillTcartDelivery(),window.deliveryMap.balloon.close(),v.showPickupInfo(t.id,p),v.hidePaymentMethod(e)},{balloonContentHeader:o,balloonContentBody:n,balloonContentFooter:""}}(l),{preset:"islands#circleIcon",index:l});e.options.set({gridSize:80,clusterDisableClickZoom:!1}),e.add(r),window.deliveryMap.geoObjects.add(e),window.deliveryMap.setBounds(e.getBounds(),{checkZoomRange:!0})})},setPostalCodeInput:function(e){$(".t706").find('input[name="tildadelivery-postalcode"]').val(e)},setHashInput:function(e){$(".t706").find('input[name="tildadelivery-hash"]').val(e)},createSearchbox:function(e,t){var r=document.createElement("div");$(r).addClass("searchbox-wrapper"),$(r).attr("id",t);var a=document.createElement("div");$(a).addClass("searchbox-inner-wrapper"),$(a).append(e);var i=document.createElement("div");$(i).addClass("searchbox-list"),$(a).append(i),$(r).append(a);var s=document.createElement("div");return $(s).addClass("searchbox-info"),$(r).append(s),r},searchboxInit:function(r,a){var i,s=$("#"+r),d=$(s).find(".searchbox-input"),o=d.closest(".t-input-block"),n=this;$(d).on("paste keyup",function(e){var t=e;clearTimeout(i),n.deliveryState.searchboxes[r]&&(n.deliveryState.searchboxes[r].address=null),n.deliveryState.searchboxes[r]&&"pickup"!==a&&(n.deliveryState.searchboxes[r].autocompleteAddress=null),""===d.val()||o.hasClass("active")||o.addClass("active"),i=setTimeout(function(){n.changeSearchboxInputHandler(t,s,a),i=null},500)}),$(d).on("focusout",function(){clearTimeout(i),n.focusoutSearchboxInputHandler(s,a)}),$(d).on("click",function(e){clearTimeout(i),n.clickSearchboxInputHandler(e,s,a)})},clickSearchboxInputHandler:function(e,a,i){var s=$(a).find(".searchbox-input"),t=s.closest(".t-input-block");if(""===s.val()||t.hasClass("active")||t.addClass("active"),!(0<$(a).find(".searchbox-list-item").length||s.hasClass("load"))){a.unbind();var r,d,o=parseInt(s.attr("data-service-id"));o&&(r=this.deliveryState.services[o].strongAddress);var n=this,c=$(a).find(".searchbox-list"),l=a.attr("id");this.deliveryState.searchboxes[l]&&"pickup"!==i&&(this.deliveryState.searchboxes[l].autocompleteAddress=null);var u,p,v,y=e.target.value;switch(a.hasClass("load")||(d=setTimeout(function(){a.addClass("load")},500)),i){case"city":if(u={pattern:y},u=JSON.stringify(u),n.deliveryState.searchboxes[l]&&(n.deliveryState.searchboxes[l].autocompleteAddress||n.deliveryState.staticCities)){if(clearTimeout(d),a.removeClass("load"),(v=n.deliveryState.staticCities||n.deliveryState.searchboxes[l].autocompleteAddress).error||0===v.length)return void(""!==s.val()?c.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):c.html(""));n.deliveryState.searchboxes[l].autocompleteAddress=v[0],n.deliveryState.searchboxes[l].addresses=v,n.deliveryState.autocompleteData.cities=v,n.fillSearchList(c,v,"address"),n.choseSearchListItemHandler(a,i)}else $.when(n.getAddresses(u,i)).done(function(e){clearTimeout(d),a.removeClass("load"),e.error||0===e.length?""!==s.val()?c.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):c.html(""):(n.deliveryState.searchboxes[l].autocompleteAddress=e[0],n.deliveryState.searchboxes[l].addresses=e,n.deliveryState.autocompleteData.cities=e,n.fillSearchList(c,e,"address"),n.choseSearchListItemHandler(a,i))});break;case"pickup":if(p=$(s).attr("data-service-id"),n.deliveryState.searchboxes[l]&&n.deliveryState.searchboxes[l].autocompleteAddress){if(clearTimeout(d),a.removeClass("load"),(v=n.deliveryState.searchboxes[l].autocompleteAddress).error||0===v.length){c.html("");var h=window.tildaBrowserLang.toLowerCase(),m=v.userFriendlyError?v.userFriendlyError[h]?v.userFriendlyError[h]:v.userFriendlyError.en:"";return void(v.error&&tcart__errorHandler.show(m||v.error))}v=v.filter(function(e){return-1!==e.name.toLowerCase().indexOf(y.toLowerCase())||-1!==e.address.toLowerCase().indexOf(y.toLowerCase())}),n.deliveryState.searchboxes[l]||(n.deliveryState.searchboxes[l]={}),n.fillSearchList(c,v,"pickup"),n.choseSearchListItemHandler(a,i)}else $.when(n.getPickupList(n.deliveryState.projectId,n.deliveryState.city.postalCode,p,y)).done(function(e){var t,r;clearTimeout(d),a.removeClass("load"),e.error||0===e.length?(""!==s.val()?c.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):c.html(""),t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"",e.error&&tcart__errorHandler.show(r||e.error)):(n.deliveryState.searchboxes[l]||(n.deliveryState.searchboxes[l]={}),n.deliveryState.searchboxes[l].autocompleteAddress=e,n.deliveryState.pickupList=e,n.fillSearchList(c,e,"pickup"),n.choseSearchListItemHandler(a,i))});break;case"street":u={pattern:y,fias:this.deliveryState.cityGuid},u=JSON.stringify(u),n.deliveryState.searchboxes[l]||(n.deliveryState.searchboxes[l]={}),r&&"street"===i&&s.attr("data-option-selected",!1),$.when(n.getAddresses(u,i)).done(function(e){clearTimeout(d),a.removeClass("load"),e.error||0===e.length?""!==s.val()?c.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):c.html(""):(n.deliveryState.searchboxes[l].autocompleteAddress=e[0],n.fillSearchList(c,e,"address"),n.choseSearchListItemHandler(a,i))});break;case"house":u={pattern:y,fias:this.deliveryState.streetGuid||this.deliveryState.cityGuid},u=JSON.stringify(u),$.when(n.getAddresses(u,i)).done(function(e){clearTimeout(d),a.removeClass("load"),e.error||0===e.length?c.html(""):(n.deliveryState.searchboxes[l]||(n.deliveryState.searchboxes[l]={}),n.deliveryState.searchboxes[l].autocompleteAddress=e[0],n.fillSearchList(c,e,"address"),n.choseSearchListItemHandler(a,i))});break;default:clearTimeout(d),a.removeClass("load")}}},changeSearchboxInputHandler:function(e,t,r){t.unbind();var a,i,s=this,d=$(t).find(".searchbox-list"),o=$(t).find(".searchbox-input"),n=o.closest(".t-input-block"),c=t.attr("id"),l=parseInt(o.attr("data-service-id"));if(l&&(a=this.deliveryState.services[l].strongAddress),!o.hasClass("load")){var u,p,v=e.target.value;switch(t.hasClass("load")||(i=setTimeout(function(){t.addClass("load")},50)),""==o.val()&&n.removeClass("active"),r){case"city":if(u={pattern:v},u=JSON.stringify(u),s.deliveryState.searchboxes[c]||(s.deliveryState.searchboxes[c]={}),s.deliveryState.searchboxes[c]&&s.deliveryState.staticCities){if(clearTimeout(i),t.removeClass("load"),p=s.deliveryState.staticCities,Array.isArray(p)?p=p.filter(function(e){return-1!==e.name.toLowerCase().indexOf(v.toLowerCase())||-1!==e.fullName.toLowerCase().indexOf(v.toLowerCase())}):console.log(p),0===p.length)return void(""!==o.val()?d.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):d.html(""));s.deliveryState.searchboxes[c].autocompleteAddress=p[0],s.deliveryState.searchboxes[c].addresses=p,s.deliveryState.autocompleteData.cities=p,s.fillSearchList(d,p,"address"),s.choseSearchListItemHandler(t,r)}else $.when(s.getAddresses(u,r)).done(function(e){clearTimeout(i),t.removeClass("load"),e.error||0===e.length?""!==o.val()?d.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):d.html(""):(s.deliveryState.searchboxes[c].autocompleteAddress=e[0],s.deliveryState.searchboxes[c].addresses=e,s.deliveryState.autocompleteData.cities=e,s.fillSearchList(d,e,"address"),s.choseSearchListItemHandler(t,r))});break;case"pickup":if(o.attr("data-option-selected",!1),s.deliveryState.searchboxes[c]&&s.deliveryState.searchboxes[c].autocompleteAddress){if(clearTimeout(i),t.removeClass("load"),0===(p=(p=s.deliveryState.searchboxes[c].autocompleteAddress).filter(function(e){return-1!==e.name.toLowerCase().indexOf(v.toLowerCase())||-1!==e.address.toLowerCase().indexOf(v.toLowerCase())})).length)return void(""!==o.val()?d.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):d.html(""));s.fillSearchList(d,p,"pickup"),s.choseSearchListItemHandler(t,r)}break;case"street":u={pattern:v,fias:this.deliveryState.cityGuid},u=JSON.stringify(u),s.deliveryState.searchboxes[c]||(s.deliveryState.searchboxes[c]={}),a&&o.attr("data-option-selected",!1),$.when(s.getAddresses(u,r)).done(function(e){clearTimeout(i),t.removeClass("load"),e.error||0===e.length?""!==o.val()?d.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):d.html(""):(s.deliveryState.searchboxes[c].autocompleteAddress=e[0],s.deliveryState.searchboxes[c].addresses=e,s.fillSearchList(d,e,"address"),s.choseSearchListItemHandler(t,r))});break;case"house":u={pattern:v,fias:this.deliveryState.streetGuid||this.deliveryState.cityGuid},u=JSON.stringify(u),s.deliveryState.searchboxes[c]||(s.deliveryState.searchboxes[c]={}),$.when(s.getAddresses(u,r)).done(function(e){clearTimeout(i),t.removeClass("load"),e.error||0===e.length?""!==o.val()?d.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):d.html(""):(s.deliveryState.searchboxes[c].autocompleteAddress=e[0],s.deliveryState.searchboxes[c].addresses=e,s.fillSearchList(d,e,"address"),s.choseSearchListItemHandler(t,r))})}}},choseSearchListItemHandler:function(a,i){var s,d,o,n=a.attr("id"),c=$(a).find(".searchbox-input"),l=$(a).find(".t-input-description"),u=$(a).find(".searchbox-list"),e=$(a).find(".searchbox-list-item"),p=this,v=c.closest(".t-input-block");tcart__inputErrorHandler.hide(c),e.on("click",function(t){switch(v.removeClass("active"),d=p.deliveryState.focusoutTimers[n],clearTimeout(d),s=t.target.dataset.postalcode,p.deliveryState.postalCode=s,p.setPostalCodeInput(s),p.deliveryState.searchboxes[n]||(p.deliveryState.searchboxes[n]={}),i){case"city":c.addClass("load"),tcart__errorHandler.hide(),c.val(t.target.dataset.name),l.html(t.target.dataset.fullName),$('.t706 [name="tildadelivery-country"]').val(t.target.dataset.countryIso),c.attr("data-guid",t.target.dataset.guid),p.deliveryState.ymapApiKey&&$.when(p.getCityCoordinates("yandex",t.target.dataset.name)).done(function(e){var t;try{(t=e.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(t=[t[1],t[0]],p.deliveryState.cityCoordinates=t)}catch(e){console.error(e)}}),p.deliveryState.searchboxes[n].address={name:t.target.dataset.name,postalCode:s,guid:t.target.dataset.guid},p.deliveryState.city={name:t.target.dataset.name,fullName:t.target.dataset.fullName,postalCode:s,guid:t.target.dataset.guid},p.deliveryState.cityPostalCode=s;var e=p.deliveryState.autocompleteData.cities.find(function(e){return e.guid==t.target.dataset.guid});p.deliveryState.geoData=e,p.deliveryState.cityGuid=t.target.dataset.guid,p.deliveryState.streetGuid=null,p.deliveryState.fullNames={},p.deliveryState.fullNames.city=t.target.dataset.fullName,$("#delivery-services-wrapper").html(""),p.renderServices(s);break;case"street":o=parseInt(c.attr("data-service-id")),c.val(t.target.dataset.shortname),c.attr("data-guid",t.target.dataset.guid),p.deliveryState.searchboxes[n].address={name:t.target.dataset.name,shortName:t.target.dataset.shortname,postalCode:s,guid:t.target.dataset.guid},p.deliveryState.streetGuid=t.target.dataset.guid,p.deliveryState.fullNames.street=t.target.dataset.shortname,p.deliveryState.fullNames.house=null,p.clearHouseInput(),$.when(p.getDeliveryPrice(p.deliveryState.projectId,s,o)).done(function(e){var t,r,a;e.error||0===e.length?(t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"",e.error&&tcart__errorHandler.show(r||e.error)):(e.hash&&p.setHashInput(e.hash),e.price&&(a=e.price,p.updatePriceValueInRadio(a,o)),p.setFullAddress(p.getFullAddress()),tcart__showDeliveryPrice())});break;case"pickup":var r=t.target.dataset.coordinates.split(",");p.hidePaymentMethod(t.target),p.changePickupHandler(t.target.dataset.pickupid,t.target.dataset.name,s,a,t.target.dataset.address,r),p.deliveryState.searchboxes[n].address={name:t.target.dataset.name,pickupid:t.target.dataset.pickupid,postalCode:s},p.deliveryState.fullNames[i]=t.target.dataset.address,p.showPickupInfo(t.target.dataset.pickupid,a);break;case"house":o=parseInt(c.attr("data-service-id")),c.val(t.target.dataset.name),p.deliveryState.searchboxes[n].address={postalCode:s},p.deliveryState.fullNames[i]=t.target.dataset.name,$.when(p.getDeliveryPrice(p.deliveryState.projectId,s,o)).done(function(e){var t,r,a;e.error||0===e.length?(t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"",e.error&&tcart__errorHandler.show(r||e.error)):(e.hash&&p.setHashInput(e.hash),e.price&&(a=e.price,p.updatePriceValueInRadio(a,o)),p.setFullAddress(p.getFullAddress()),tcart__showDeliveryPrice())})}u.html(""),c.attr("data-option-selected",!0)})},focusoutSearchboxInputHandler:function(a,i){var s,d,o,n=this,c=$(a).find(".searchbox-list"),l=$(a).find(".t-input-description"),u=a.attr("id"),p=$(a).find(".searchbox-input"),v=p.closest(".t-input-block"),y=parseInt(p.attr("data-service-id"));y?(o=this.deliveryState.services[y].strongAddress,p.attr("data-option-selected",!1)):p.attr("data-option-selected",!0),this.deliveryState.focusoutTimers[u]=setTimeout(function(){if(v.removeClass("active"),n.deliveryState.searchboxes[u]&&n.deliveryState.searchboxes[u].address)return tcart__inputErrorHandler.hide(p),void c.html("");switch(i){case"city":var e;n.deliveryState.searchboxes[u].autocompleteAddress&&p.val()===n.deliveryState.searchboxes[u].autocompleteAddress.name?(p.addClass("load"),d=n.deliveryState.searchboxes[u].autocompleteAddress,n.deliveryState.searchboxes[u].address=d,tcart__inputErrorHandler.hide(p),n.deliveryState.ymapApiKey&&$.when(n.getCityCoordinates("yandex",d.name)).done(function(e){var t;try{(t=e.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(t=[t[1],t[0]],n.deliveryState.cityCoordinates=t)}catch(e){console.error(e)}}),s=d.postalCode,n.deliveryState.postalCode=s,n.setPostalCodeInput(s),$('[name="tildadelivery-country"]').val(d.countryIso),p.val(d.name),l.html(d.fullName),p.attr("data-guid",d.guid),n.deliveryState.city.name=d.name,n.deliveryState.city.fullName=d.fullName,n.deliveryState.city.postalCode=s,n.deliveryState.city.guid=d.guid,n.deliveryState.cityPostalCode=s,n.deliveryState.cityGuid=d.guid,n.deliveryState.streetGuid=null,n.deliveryState.fullNames={},n.deliveryState.fullNames[i]=d.fullName,e=n.deliveryState.autocompleteData.cities.find(function(e){return e.guid==d.guid}),n.deliveryState.geoData=e,c.html(""),$("#delivery-services-wrapper").html(""),n.renderServices(s),p.attr("data-option-selected",!0)):(c.html(""),l.html(""),$("#delivery-services-wrapper").html(""),$("#addresses-wrapper").remove(),p.attr("data-option-selected",!1),n.deliveryState.streetGuid=null,n.deliveryState.fullNames={},tcart__inputErrorHandler.show(p,tcart__dict(35,"Please select an city from the options provided")));break;case"street":n.deliveryState.searchboxes[u]&&n.deliveryState.searchboxes[u].autocompleteAddress&&p.val()===n.deliveryState.searchboxes[u].autocompleteAddress.shortName?(d=n.deliveryState.searchboxes[u].autocompleteAddress,n.deliveryState.searchboxes[u].address=d,n.deliveryState.fullNames[i]=d.shortName,tcart__inputErrorHandler.hide(p),s=d.postalCode,n.deliveryState.postalCode=s,p.val(d.shortName),p.attr("data-guid",d.guid),n.deliveryState.streetGuid=d.guid,n.setPostalCodeInput(s),p.attr("data-option-selected",!0),c.html(""),$.when(n.getDeliveryPrice(n.deliveryState.projectId,s,y)).done(function(e){var t,r,a;e.error||0===e.length?(t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"",e.error&&tcart__errorHandler.show(r||e.error)):(e.hash&&n.setHashInput(e.hash),e.price&&(a=e.price,n.updatePriceValueInRadio(a,y)),n.setFullAddress(n.getFullAddress()),tcart__showDeliveryPrice())})):(o&&(p.attr("data-option-selected",!1),c.html(""),tcart__inputErrorHandler.show(p,tcart__dict(34,"Please select an address from the options provided"))),c.html("")),n.deliveryState.fullNames.house=null,n.clearHouseInput();break;case"house":n.deliveryState.searchboxes[u]&&n.deliveryState.searchboxes[u].autocompleteAddress&&p.val()===n.deliveryState.searchboxes[u].autocompleteAddress.name?(d=n.deliveryState.searchboxes[u].autocompleteAddress,n.deliveryState.searchboxes[u].address=d,n.deliveryState.fullNames[i]=d.name,tcart__inputErrorHandler.hide(p),s=d.postalCode,n.deliveryState.postalCode=s,p.val(d.name),p.attr("data-option-selected",!0),n.setPostalCodeInput(s),c.html(""),$.when(n.getDeliveryPrice(n.deliveryState.projectId,s,y)).done(function(e){var t,r,a;e.error||0===e.length?(t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"",e.error&&tcart__errorHandler.show(r||e.error)):(e.hash&&n.setHashInput(e.hash),e.price&&(a=e.price,n.updatePriceValueInRadio(a,y)),n.setFullAddress(n.getFullAddress()),tcart__showDeliveryPrice())})):c.html("");break;case"pickup":c.html("");var t=null,r=null;n.deliveryState.searchboxes[u]&&n.deliveryState.searchboxes[u].autocompleteAddress&&(t=d=n.deliveryState.searchboxes[u].autocompleteAddress).forEach(function(e){e.name===p.val()&&(r=e)}),t&&r?(d=r,n.deliveryState.searchboxes[u].address=d,n.deliveryState.fullNames[i]=d.address,tcart__inputErrorHandler.hide(p),p.attr("data-option-selected",!0),n.changePickupHandler(d.id,d.name,d.postalCode,a,d.address,d.coordinates),n.setPostalCodeInput(d.postalCode),n.deliveryState.postalCode=d.postalCode,c.html("")):(p.attr("data-option-selected",!1),tcart__inputErrorHandler.show(p,tcart__dict(34,"Please select an address from the options provided")))}},200)},fillSearchList:function(e,t,s){var d,o,n,c=document.createElement("div");t.forEach(function(e){var t,r=document.createElement("div");switch($(r).addClass("searchbox-list-item t-text"),s){case"pickup":o=e.name,n=e.address;var a="";e.cash&&"n"===e.cash&&(a+="cash"),r.dataset.restrictions=a;break;case"address":n=e.fullName?(o=e.fullName.split(",").reverse()[0],(t=(t=e.fullName).split(",").reverse()).shift(),t=t.join(", ")):(o=e.name,"")}r.dataset.name=e.name,r.dataset.fullName=e.fullName||"",r.dataset.postalcode=e.postalCode,r.dataset.guid=e.guid||"",r.dataset.pickupid=e.id||"",r.dataset.shortname=e.shortName||"",r.dataset.address=e.address||"",r.dataset.coordinates=e.coordinates||"",r.dataset.countryIso=e.countryIso||"";var i=document.createElement("div");i.classList.add("searchbox-list-item-text"),i.innerHTML=o,$(r).append(i),(d=document.createElement("div")).classList.add("searchbox-list-item-description"),d.innerHTML=n,$(r).append(d),$(c).append(r)}),e.html(c.outerHTML),e.scrollTop(0)},showPickupInfo:function(t,e){var r,a=$(e).find(".searchbox-info");e.addClass("show-info"),this.deliveryState.pickupList.forEach(function(e){e.id!=t||(r=e)});var i=r.name,s=r.address||"",d=r.workTime||"",o=r.phones||"",n=r.addressComment||"",c="";c+='<p style="font-weight: 400; margin-bottom: 15px;" class="t-text">'+tcart__dict(33,"Pickup location")+":</p>",c+='<p class="t-text">'+i+"</p>",c+='<p class="t-text">'+tcart__dict(31,"Address")+": "+s+"</p>",n&&(c+='<p class="t-text" style="opacity: 0.6; line-height: 22px; font-size: .9rem;">'+n+"</p>"),c+=d?'<p class="t-text">'+tcart__dict(40,"Working hours")+": "+d+"</p>":"",o.length&&(c+=1<o.length?'<p class="t-text">'+tcart__dict(38,"Phones")+": "+o.join(", ")+"</p>":'<p class="t-text">'+tcart__dict(39,"Phone")+": "+o.join(", ")+"</p>"),c+='<span style="border-bottom: 1px dashed #000; font-weight: 400; margin-top: 10px; display: inline-block; cursor: pointer;" class="t-text searchbox-change-pickup">'+tcart__dict(46,"Change")+"</span>",a.html(c)},declOfNum:function(e,t){return t[4<e%100&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]},renderServices:function(r){this.deliveryState.services={},this.deliveryState.postalCode={},$("#delivery-services-wrapper").html(""),$("#addresses-wrapper").remove();var e=this.deliveryState.cityPostalCode||"",p=this,t=this.deliveryState.currencyCode,a=$(".t706 #city-searchbox input"),i=$(".t-radio__wrapper-delivery").first();$.when(this.getServices(this.deliveryState.projectId,e,t)).then(function(u){if(u.error){var e=window.tildaBrowserLang.toLowerCase(),t=u.userFriendlyError?u.userFriendlyError[e]?u.userFriendlyError[e]:u.userFriendlyError.en:"";return tcart__errorHandler.show(t||u.error),window.tcart.emtpyDeliveryServices=!0,void a.removeClass("load")}0===u.length?(window.tcart.emtpyDeliveryServices=!0,tcart__errorHandler.show(tcart__dict(29,"Unfortunately, delivery to your chosen city is not possible")),a.removeClass("load")):window.tcart.emtpyDeliveryServices=!1,u.forEach(function(e,t){if(e.currency&&e.currency!==p.deliveryState.currencyCode)return console.error(e.title+": wrong delivery currency ("+e.currency+")"),void(u.length===t+1&&($(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset"),$(".t706 #city-searchbox input").removeClass("load")));p.deliveryState.services[e.id]={},p.deliveryState.services[e.id].fields=e.fields,p.deliveryState.services[e.id].strongAddress=e.strongAddress;var r,a=e.hint||"",i=e.title||"",s=e.minimumPrice||"",d=!1,o=e.freeDeliveryThreshold||"",n=p.declOfNum(e.minimumDeliverTime,[tcart__dict(25,"day"),tcart__dict(26,"days"),tcart__dict(26,"days")]);e.staticPrice&&e.minimumDeliverTime?r=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+n+", "+tcart__showPrice(e.staticPrice):e.staticPrice?r=tcart__showPrice(e.staticPrice):e.minimumDeliverTime&&e.minimumPrice?r=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+n+", "+tcart__dict(27,"from")+" "+tcart__showPrice(e.minimumPrice):e.minimumPrice?r=tcart__dict(27,"from")+" "+tcart__showPrice(e.minimumPrice):e.minimumDeliverTime&&(r=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+n),"delivery"===e.type&&(s="");var c="";"n"===e.cash&&(c+="cash"),0===t&&(d=!0);var l=tcart_newDelivery.createRadio(i,r,s,e.type,null,e.id,t,e.staticPrice,a,e.hash,c,d,o);$("#delivery-services-wrapper").append(l)}),tcart__updateDelivery(),tcart_newDelivery.changeDeliveryTypeListener(),$('#delivery-services-wrapper [checked="checked"]').trigger("change"),$(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset"),tcart__showDeliveryPrice()},function(){var e,t;p.deliveryState.badResponseCounters.services++,p.deliveryState.badResponseCounters.services<5?setTimeout(function(){p.renderServices(r)},1e3):(tcart__preloader.hide(),e=tcart_newDelivery.createInput("",tcart__dict(22,"Commentary"),tcart__dict(41,"Delivery data for manager"),null,null,null,"","delivery-badresponse-comment",null,null,!0),t='<div style="margin: 20px 0; line-height: 22px; color: red;" class="t-text">',t+=tcart__dict(42,'Unfortunately, the delivery service is currently unavailable. Please indicate the delivery address in a free form in the "Comment" field, the store manager will contact you shortly on the contact information provided'),t+="</div>",window.tcart&&(window.tcart.system="none"),i.append(t),i.append(e))})},getCityFromGeo:function(e){var t={projectId:e},t=JSON.stringify(t);return $.ajax({type:"POST",url:"https://geoserv.tildacdn.com/api/detect-city/",dataType:"json",data:t,success:function(){},error:function(e){console.error(e)}})},getPayTypes:function(){var e,t=$("#allrecords").data("tilda-paytypes");try{t&&("object"==typeof t||"function"==typeof t)||(t={},$("input[name=paymentsystem]").each(function(){"cash"==$(this).val()?t.cash="y":"banktransfer"==$(this).val()?t.banktransfer="y":t.card="y"}),t.card||t.cash||t.banktransfer||("cash"==(e=$(".t706").eq(0).data("payment-system"))?t.cash="y":"banktransfer"==e?t.banktransfer="y":e&&""!=e&&"none"!=e?t.card="y":t.none="y"),$("#allrecords").data("tilda-paytypes",t))}catch(e){}return t},getServices:function(e,t,r){var a=window.tcart.total;if(!a||a<1)return{error:new Error("items count is empty")};var i={action:"list",projectId:e,postalCode:t=t||0,currency:r,itemsCount:a,cartAmount:window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,geoData:this.deliveryState.geoData||{},products:window.tcart.products||[],paytypes:this.getPayTypes()},i=JSON.stringify(i);return tcart__preloader.show($("#delivery-services-wrapper"),tcart__dict(43,"Receiving delivery services")),tcart__hideDeliveryPrice(),$.ajax({type:"POST",url:"https://delivery.tildacdn.com/cart-api/",data:i,dataType:"json",success:function(){tcart__preloader.hide()},error:function(e){console.error(e)}})},getPickupList:function(e,t,r,a){var i=this.deliveryState.geoData||{},s={action:"pickup-list",projectId:e,postalCode:t,deliveryId:r,pattern:a,itemsCount:window.tcart.total||0,cartAmount:window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,geoData:i,products:window.tcart.products||[],paytypes:this.getPayTypes()},s=JSON.stringify(s);return $.ajax({type:"POST",url:"https://delivery.tildacdn.com/cart-api/",data:s,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getDeliveryPrice:function(e,t,r,a){tcart__hideDeliveryPrice();t=t||0;var i=window.tcart.total||0,s=window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,d=window.tcart.products||[],o=this.deliveryState.cityGuid||0,n={action:"calculate",projectId:e,postalCode:t,deliveryId:r,currency:this.deliveryState.currencyCode,itemsCount:i,cartAmount:s,pickupPointId:a,products:d,guid:o},n=JSON.stringify(n);return $.ajax({type:"POST",url:"https://delivery.tildacdn.com/cart-api/",data:n,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getCityCoordinates:function(e,t){var r="https://geocode-maps.yandex.ru/1.x/?apikey="+this.deliveryState.ymapApiKey+"&format=json&geocode="+t;return $.ajax({type:"GET",url:r,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getAddresses:function(e,t){var r,a=this;switch(this.deliveryState.currentRequest&&a.deliveryState.currentRequest.abort(),t){case"street":r="https://geoserv.tildacdn.com/api/address/";break;case"city":r="https://geoserv.tildacdn.com/api/city/";break;case"pickup":r="https://delivery.tildacdn.com/cart-api/";break;case"house":r="https://geoserv.tildacdn.com/api/house/"}return this.deliveryState.currentRequest=$.ajax({type:"POST",url:r,data:e,dataType:"json",success:function(){a.deliveryState.currentRequest=null},error:function(e){a.deliveryState.currentRequest=null}}),this.deliveryState.currentRequest},createInput:function(e,t,r,a,i,s,d,o,n,c,l,u,p){r=r||"",a=a||"",l=l?1:0;var v="";return v+="<div "+(c?'style="'+c+'"':"")+" "+(n?"hidden":"")+' class="t-input-group t-input-group_in" data-input-lid="">',v+='<div class="t-input-title t-descr t-descr_md" data-redactor-toolbar="no" field="">'+(t=t||"")+"</div>",v+='<div class="t-input-block">',v+='<input class="'+(d=d+" t-input"||"t-input")+'" '+((p=p||"")?'data-tilda-rule="'+p+'"':"")+" "+((u=u||"")?'inputmode="'+u+'"':"")+"  "+((e=e||"")?'type="'+e+'"':"")+' data-service-id="'+(s=s||"")+'" '+((i=i||"")?'id="'+i+'"':"")+' name="'+o.toLowerCase()+'" value="'+a+'" placeholder="'+r+'" autocomplete="no" data-tilda-req='+l+" />",v+=' <svg class="t706__search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88"> <path fill="#3f3f3f" d="M85 31.1c-.5-8.7-4.4-16.6-10.9-22.3C67.6 3 59.3 0 50.6.6c-8.7.5-16.7 4.4-22.5 11-11.2 12.7-10.7 31.7.6 43.9l-5.3 6.1-2.5-2.2-17.8 20 9 8.1 17.8-20.2-2.1-1.8 5.3-6.1c5.8 4.2 12.6 6.3 19.3 6.3 9 0 18-3.7 24.4-10.9 5.9-6.6 8.8-15 8.2-23.7zM72.4 50.8c-9.7 10.9-26.5 11.9-37.6 2.3-10.9-9.8-11.9-26.6-2.3-37.6 4.7-5.4 11.3-8.5 18.4-8.9h1.6c6.5 0 12.7 2.4 17.6 6.8 5.3 4.7 8.5 11.1 8.9 18.2.5 7-1.9 13.8-6.6 19.2z"></path> </svg>',v+='<div class="t-input-clear"></div>',v+="</div>",v+='<div class="t-input-error"></div>',v+='<div class="t-input-description t-text t-text_xs" style="color: #505050; margin: 5px 0 0;"></div>',v+="</div>"},createRadio:function(e,t,r,a,i,s,d,o,n,c,l,u,p){var v="";return v+='<label class="'+(i=i?i+" t-radio__control t-text t-text_xs":"t-radio__control t-text t-text_xs")+'" '+(s?'data-service-id="'+s+'"':"")+">",v+="<input  "+((l=l||"")?'data-restrictions="'+l+'"':"")+((p=p||"")?'data-free-delivery-threshold="'+p+'"':"")+((c=c||"")?'data-hash-value="'+c+'"':"")+" "+((n=n||"")?'data-hint-text="'+n+'"':"")+" "+(o?'data-static-price="'+o+'"':"")+" "+(o?'data-delivery-price="'+o+'"':'data-delivery-price=""')+" "+(u=u&&'checked="checked"')+' data-service-id="'+s+'" type="radio" data-delivery-type='+a+' name="tildadelivery-type" value="'+(e=e||"")+'" class="t-radio t-radio_delivery js-tilda-rule" data-tilda-req="1">',v+='<div class="t-radio__indicator" style="border-color:#000000"></div>',v+='<span class="delivery-checkbox-label">'+e+" </span>",v+='<span class="delivery-minimum">'+(t=t||"")+" </span>",v+="</label>"},createTitle:function(e,t){var r="";return r+='<div class="t-name t-name_md'+(t=t||"")+'" style="margin: 20px 0;">'+(e=e||"")+"</div>"},createSelect:function(e,t,r,a,i){var s="";return s+='<label class="t-input-title t-descr t-descr_md">Пункт выдачи</label>',s+='<div class="ss-select delivery-pickup-select">',s+='<select class="ss-input ss-select delivery-select" data-service-id="'+a+'" name="'+(i=i||"")+'">',s+='<option data-point-id="">Не выбран</option>',r.forEach(function(e){s+="<option data-point-id="+e.id+">"+e.address+"</option>"}),s+="</select>",s+="</div>"},changeDeliveryTypeListener:function(){var r=this;$("input[data-delivery-type]").change(function(){var e=parseInt($(this).attr("data-service-id"),10)||0,t=parseInt($(this).attr("data-free-delivery-threshold"),10);r.deliveryState.freeDeliveryThreshold=t||0,r.deliveryState.activeServiceUid=e,tcart__errorHandler.hide(),r.renderAddressFields(this),this.dataset.hashValue&&r.setHashInput(this.dataset.hashValue),r.hidePaymentMethod(this),$("input[data-delivery-type]").each(function(e,t){0<$(t).attr("data-static-price")?$(t).attr("data-delivery-price",$(t).attr("data-static-price")):$(t).attr("data-delivery-price","")}),r.hints.deleteAll(),r.deliveryState.fullNames.pickup=null,r.deliveryState.fullNames.street=null,r.deliveryState.fullNames.house=null,r.deliveryState.searchboxes["pickup-searchbox"]&&(r.deliveryState.searchboxes["pickup-searchbox"]=null),$(this).attr("data-hint-text")&&r.hints.render($(this).attr("data-hint-text")),tcart__updateDelivery()})},hidePaymentMethod:function(e){var t=$(".t706").find("[data-payment-variant-system='cash']"),r=$(".t706").find("[data-payment-variant-system='cash']").parent(),a=r.closest(".t-radio__wrapper-payment").find("[data-payment-variant-system]").not("[data-payment-variant-system='cash']").first();"cash"===e.dataset.restrictions&&t.length?(r.hide(),a.prop("checked",!0),a.trigger("change")):r.show()},updatePriceValueInRadio:function(e,t){$('.t706__cartwin input[data-service-id="'+t+'"]').attr("data-delivery-price",e),tcart__updateDelivery(),tcart__showDeliveryPrice()},changePickupHandler:function(i,e,t,r,a,s){var d,o=$(r).find(".searchbox-input"),n=o.attr("data-service-id"),c=this;t=t||this.deliveryState.city.postalCode,o.attr("data-pickup-id",i),o.attr("data-pickup-address",a),o.val(e),$.when(c.getDeliveryPrice(c.deliveryState.projectId,t,n,i)).done(function(e){var t,r,a=e.price;e.error||0===e.length?(t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"",e.error&&tcart__errorHandler.show(r||e.error)):(e.hash&&c.setHashInput(e.hash),i||(a=0),c.updatePriceValueInRadio(a,n),c.setFullAddress(c.getFullAddress()))}),s&&(d=0==s[0]&&0==s[1]),s&&window.deliveryMap&&!d&&window.deliveryMap.setCenter(s,16)},renderAddressFields:function(e){this.disableChoseServiceControls();var d=this,t=$(".t-radio__wrapper-delivery").first();0<$("#addresses-wrapper").length&&$("#customdelivery").attr("data-service-id")!==$(e).attr("data-service-id")&&$("#addresses-wrapper").remove(),$("#customdelivery").attr("data-service-id",$(e).attr("data-service-id"));var o=document.createElement("div");o.id="addresses-wrapper",$(o).css("margin","20px 0"),t.append(o);var r=$(e).attr("data-delivery-type"),n=$(e).attr("data-service-id"),c=$(".t706 #city-searchbox input");switch(r){case"pickup":tcart__preloader.show($("#addresses-wrapper"),tcart__dict(44,"Getting a list of points of issue of orders")),$.when(d.getPickupList(d.deliveryState.projectId,d.deliveryState.city.postalCode,n)).done(function(e){if(e.error){var t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"";return tcart__errorHandler.show(r||e.error),tcart__preloader.hide(),d.enableChoseServiceControls(),void c.removeClass("load")}tcart__preloader.hide();var a=d.createInput("",tcart__dict(33,"Pickup location"),tcart__dict(24,"Select pickup location"),null,null,n,"searchbox-input js-tilda-rule","tildadelivery-pickup-name",null,null,!0,null,"chosevalue"),i=d.createSearchbox(a,"pickup-searchbox");$("#addresses-wrapper").append(i.outerHTML),d.deliveryState.searchboxes["pickup-searchbox"]={},d.deliveryState.searchboxes["pickup-searchbox"].autocompleteAddress=e,d.deliveryState.pickupList=e,d.deliveryState.ymapApiKey&&d.mapInit("yandex"),d.searchboxInit("pickup-searchbox","pickup",null,e),d.renderUserFields(o,n),d.changeCartInputsHandler();var s=$(".t706 #pickup-searchbox");d.deliveryState.ymapApiKey&&d.mapAddPoints("",e,s),d.enableChoseServiceControls(),c.removeClass("load")});break;case"delivery":d.renderUserFields(o,n),d.changeCartInputsHandler(),d.enableChoseServiceControls(),(c=$(".t706 #city-searchbox input")).removeClass("load")}},clearHouseInput:function(){$('.t706 #customdelivery [name="tildadelivery-house"]').val("")},renderUserFields:function(e,t){var r=this.deliveryState.services[t].fields,a=0;for(var i in r)switch(i){case"street":case"comment":case"userInitials":break;default:a++}var s=0;for(var d in r){var o=r[d].autocomplete,n="",c="",l="",u="",p="",v=!0;switch(d){case"street":n=tcart__dict(15,"Street"),c="width: 100%";break;case"house":s++,n=tcart__dict(16,"House"),v=!1;break;case"entrance":s++,n=tcart__dict(17,"Entrance"),l="number",v=!(u="numeric");break;case"floor":s++,n=tcart__dict(18,"Floor"),l="number",v=!(u="numeric");break;case"aptOffice":s++,n=tcart__dict(19,"Apt/Office"),v=!1;break;case"phone":s++,n=tcart__dict(20,"Phone"),l="number",u="numeric";break;case"entranceCode":s++,n=tcart__dict(21,"Entrance code"),v=!1;break;case"comment":n=tcart__dict(22,"Comment"),v=!(c="width: 100%"),p=tcart__dict(36,"Order comment");break;case"oneLineAddress":s++,n=tcart__dict(31,"Address");break;case"userInitials":c="width: 100%",n=tcart__dict(47,"Initials"),p=tcart__dict(48,"Full name")}a===s&&a%2!=0&&(c="width: 100%"),n=n||"";var y,h,m,f,_,b="tildadelivery-"+d;o?(y="house"===d?"":"chosevalue",h=tcart_newDelivery.createInput(l,n,p,"","",t,"searchbox-input js-tilda-rule",b,!1,c,v,u,y),m=d+"-searchbox",f=this.createSearchbox(h,m),$(e).append(f),this.searchboxInit(m,d)):(_=tcart_newDelivery.createInput(l,n,p,"","",t,"js-tilda-rule",b,!1,c,v,u),$(e).append(_))}},hints:{render:function(e){var t=$("#delivery-services-wrapper"),r=document.createElement("div");$(r).addClass("delivery-hint t-text t-text_xs"),r.innerHTML=e,$(t).append(r)},deleteAll:function(){$(".delivery-hint").length&&$(".delivery-hint").remove()}}},tcart__errorHandler={show:function(e){$(".t-form__errorbox-item.js-rule-error-string").html(e),$(".js-errorbox-all").css("display","block"),$(".t-form__errorbox-item.js-rule-error-string").css("display","block")},hide:function(){$(".js-errorbox-all").css("display","none"),$("t-form__errorbox-item.js-rule-error-string").css("display","none")}},tcart__inputErrorHandler={show:function(e,t){var r=e.closest(".t-input-group");r.find(".t-input-error").html(t),r.addClass("js-error-control-box")},hide:function(e){var t=e.closest(".t-input-group");t.find(".t-input-error").html(""),t.removeClass("js-error-control-box")}};function tcart__hideDeliveryPrice(){$(".t706__cartwin-totalamount-info").length&&$(".t706__cartwin-totalamount-info").css("opacity","0"),$(".t706 .delivery-full-address").length&&$(".t706 .delivery-full-address").css("opacity","0")}function tcart__showDeliveryPrice(){$(".t706__cartwin-totalamount-info").length&&$(".t706__cartwin-totalamount-info").css("opacity","1"),$(".t706 .delivery-full-address").length&&$(".t706 .delivery-full-address").css("opacity","1")}var tcart__preloader={show:function(e,t){var r;e.length&&(e.parent().find(".tcart__preloader").length||(r="",r+='<div class="tcart__preloader" style="margin: 20px 0;">',t&&(r+='<div class="t-text" style="text-align: center; opacity: .5; font-size: 15px;">'+t+"</div>"),r+='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>',r+="</div>",e.before(r)))},hide:function(){$(".tcart__preloader").remove()}};function arraysEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function tcart__rerenderDeliveryServices(){clearTimeout(window.rerenderTimer),window.rerenderTimer=setTimeout(function(){$(".t706__cartwin-content .t706__product").css("pointer-events","none"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","none");var r=tcart_newDelivery.deliveryState,e=r.services,u=r.activeServiceUid,p=tcart_newDelivery;if(!u)return $(".t706__cartwin-content .t706__product").css("pointer-events","unset"),void $(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset");var a=[],i=[];Object.keys(e).forEach(function(e){a.push(parseInt(e,10))}),$.when(tcart_newDelivery.getServices(r.projectId,r.cityPostalCode,r.currencyCode)).then(function(e){var t;e.forEach(function(e){i.push(e.id)}),a.sort(function(e,t){return e-t}),i.sort(function(e,t){return e-t}),!arraysEqual(i,a)&&!i.includes(u)?tcart_newDelivery.renderServices(r.postalCode):($(".t706 #delivery-services-wrapper").find(".t-radio__control").each(function(e,t){$(t).remove()}),e.forEach(function(e,t){var r,a,i,s,d,o,n,c,l;e.currency&&e.currency!==p.deliveryState.currencyCode?console.error(e.title+": wrong delivery currency ("+e.currency+")"):(p.deliveryState.services[e.id]={},p.deliveryState.services[e.id].fields=e.fields,p.deliveryState.services[e.id].strongAddress=e.strongAddress,r=e.hint||"",a=e.title||"",i=e.minimumPrice||"",d=e.freeDeliveryThreshold||"",o=p.declOfNum(e.minimumDeliverTime,[tcart__dict(25,"day"),tcart__dict(26,"days"),tcart__dict(26,"days")]),e.staticPrice&&e.minimumDeliverTime?s=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+o+", "+tcart__showPrice(e.staticPrice):e.staticPrice?s=tcart__showPrice(e.staticPrice):e.minimumDeliverTime&&e.minimumPrice?s=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+o+", "+tcart__dict(27,"from")+" "+tcart__showPrice(e.minimumPrice):e.minimumPrice?s=tcart__dict(27,"from")+" "+tcart__showPrice(e.minimumPrice):e.minimumDeliverTime&&(s=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+o),"delivery"===e.type&&(i=""),n="","n"===e.cash&&(n+="cash"),c=!1,e.id===u&&(c=!0),l=tcart_newDelivery.createRadio(a,s,i,e.type,null,e.id,t,e.staticPrice,r,e.hash,n,c,d),$("#delivery-services-wrapper").append(l))}),t="object"==typeof r.postalCode?r.cityPostalCode:r.postalCode,$.when(tcart_newDelivery.getDeliveryPrice(r.projectId,t,u)).done(function(e){var t;e.error&&console.error(e.error),e.hash&&tcart_newDelivery.setHashInput(e.hash),e.price&&(t=e.price,tcart_newDelivery.updatePriceValueInRadio(t,u)),tcart__updateDelivery(),tcart_newDelivery.changeDeliveryTypeListener(),$(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset"),tcart__showDeliveryPrice()}))})},500)}